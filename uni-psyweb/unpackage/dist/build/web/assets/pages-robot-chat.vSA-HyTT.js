var e,t,a,s;import{o,c as l,w as i,b as r,n,d as u,v as d,B as h,A as c,af as m,k as g,i as p,ag as y,ah as f,a as v,D as b,g as x,l as w,K as _,ai as S,m as B,a2 as k,u as C,e as $,f as L,F as V,W as j,Y as E,x as N,p as F,s as H,j as I,t as M}from"./index-D_t6mnig.js";import{m as T,a as U,r as z,_ as O,c as R}from"./uv-icon.DNv2e-gP.js";import{_ as K}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as P}from"./uv-transition.BGntRoub.js";import{_ as A}from"./uv-button.MXP0QCgh.js";import{_ as D}from"./uv-modal.wAPI-AyQ.js";import{_ as W}from"./goback.DYk21IgB.js";import{g as G,a as q}from"./system.BKBl34T1.js";import"./uv-line.DzR924X1.js";import"./uv-popup.CvTR393n.js";import"./uv-overlay.B4NbzjME.js";const Y=K({name:"uv-textarea",mixins:[T,U,{props:{value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},placeholder:{type:[String,Number],default:""},placeholderClass:{type:String,default:"textarea-placeholder"},placeholderStyle:{type:[String,Object],default:"color: #c0c4cc"},height:{type:[String,Number],default:70},confirmType:{type:String,default:"return"},disabled:{type:Boolean,default:!1},count:{type:Boolean,default:!1},focus:{type:Boolean,default:!1},autoHeight:{type:Boolean,default:!1},fixed:{type:Boolean,default:!1},cursorSpacing:{type:Number,default:0},cursor:{type:[String,Number],default:""},showConfirmBar:{type:Boolean,default:!0},selectionStart:{type:Number,default:-1},selectionEnd:{type:Number,default:-1},adjustPosition:{type:Boolean,default:!0},disableDefaultPadding:{type:Boolean,default:!1},holdKeyboard:{type:Boolean,default:!1},maxlength:{type:[String,Number],default:140},border:{type:String,default:"surround"},formatter:{type:[Function,null],default:null},ignoreCompositionEvent:{type:Boolean,default:!0},confirmHold:{type:Boolean,default:!1},textStyle:{type:[Object,String],default:()=>{}},countStyle:{type:[Object,String],default:()=>{}},...null==(t=null==(e=uni.$uv)?void 0:e.props)?void 0:t.textarea}}],data:()=>({innerValue:"",focused:!1,innerFormatter:e=>e}),created(){this.innerValue=this.modelValue},watch:{value(e){this.innerValue=e},modelValue(e){this.innerValue=e}},computed:{textareaClass(){let e=[],{border:t,disabled:a}=this;return"surround"===t&&(e=e.concat(["uv-border","uv-textarea--radius"])),"bottom"===t&&(e=e.concat(["uv-border-bottom","uv-textarea--no-radius"])),a&&e.push("uv-textarea--disabled"),e.join(" ")},textareaStyle(){return this.$uv.deepMerge({},this.$uv.addStyle(this.customStyle))},maxlen(){return this.maxlength<0?this.maxlength<0?-1:140:this.maxlength},getCount(){try{return this.innerValue.length>this.maxlen?this.maxlen:this.innerValue.length}catch(e){return 0}}},methods:{setFormatter(e){this.innerFormatter=e},onFocus(e){this.$emit("focus",e)},onBlur(e){this.$emit("blur",e),this.$uv.formValidate(this,"blur")},onLinechange(e){this.$emit("linechange",e)},onInput(e){let{value:t=""}=e.detail||{};const a=(this.formatter||this.innerFormatter)(t);this.innerValue=t,this.$nextTick((()=>{this.innerValue=a,this.valueChange()}))},valueChange(){const e=this.innerValue;this.$nextTick((()=>{this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.$uv.formValidate(this,"change")}))},onConfirm(e){this.$emit("confirm",e)},onKeyboardheightchange(e){this.$emit("keyboardheightchange",e)}}},[["render",function(e,t,a,s,y,f){const v=m,b=g,x=p;return o(),l(x,{class:c(["uv-textarea",f.textareaClass]),style:n([f.textareaStyle])},{default:i((()=>[r(v,{class:"uv-textarea__field",value:y.innerValue,style:n([{height:e.autoHeight?"auto":e.$uv.addUnit(e.height)},e.$uv.addStyle(e.textStyle)]),placeholder:e.placeholder,"placeholder-style":e.$uv.addStyle(e.placeholderStyle,"string"),"placeholder-class":e.placeholderClass,disabled:e.disabled,focus:e.focus,autoHeight:e.autoHeight,fixed:e.fixed,cursorSpacing:e.cursorSpacing,cursor:e.cursor,showConfirmBar:e.showConfirmBar,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,adjustPosition:e.adjustPosition,disableDefaultPadding:e.disableDefaultPadding,holdKeyboard:e.holdKeyboard,maxlength:f.maxlen,confirmType:e.confirmType,ignoreCompositionEvent:e.ignoreCompositionEvent,"confirm-hold":e.confirmHold,onFocus:f.onFocus,onBlur:f.onBlur,onLinechange:f.onLinechange,onInput:f.onInput,onConfirm:f.onConfirm,onKeyboardheightchange:f.onKeyboardheightchange},null,8,["value","style","placeholder","placeholder-style","placeholder-class","disabled","focus","autoHeight","fixed","cursorSpacing","cursor","showConfirmBar","selectionStart","selectionEnd","adjustPosition","disableDefaultPadding","holdKeyboard","maxlength","confirmType","ignoreCompositionEvent","confirm-hold","onFocus","onBlur","onLinechange","onInput","onConfirm","onKeyboardheightchange"]),e.count&&-1!=f.maxlen?(o(),l(b,{key:0,class:"uv-textarea__count",style:n([{"background-color":e.disabled?"transparent":"#fff"},e.$uv.addStyle(e.countStyle)])},{default:i((()=>[u(d(f.getCount)+"/"+d(f.maxlen),1)])),_:1},8,["style"])):h("",!0)])),_:1},8,["class","style"])}],["__scopeId","data-v-2ec10f78"]]);const J=K({name:"uv-image",emits:["click","load","error"],mixins:[T,U,{props:{src:{type:String,default:""},mode:{type:String,default:"aspectFill"},width:{type:[String,Number],default:"300"},height:{type:[String,Number],default:"225"},shape:{type:String,default:"square"},radius:{type:[String,Number],default:0},lazyLoad:{type:Boolean,default:!0},observeLazyLoad:{type:Boolean,default:!1},showMenuByLongpress:{type:Boolean,default:!0},loadingIcon:{type:String,default:"photo"},errorIcon:{type:String,default:"error-circle"},showLoading:{type:Boolean,default:!0},showError:{type:Boolean,default:!0},fade:{type:Boolean,default:!0},webp:{type:Boolean,default:!1},duration:{type:[String,Number],default:500},bgColor:{type:String,default:"#f3f4f6"},cellChild:{type:Boolean,default:!1},...null==(s=null==(a=uni.$uv)?void 0:a.props)?void 0:s.image}}],data(){return{isError:!1,loading:!0,backgroundStyle:{},show:!1,observeShow:!this.observeLazyLoad,elIndex:"",imgWidth:this.width,imgHeight:this.height,thresholdValue:50}},watch:{src:{immediate:!0,handler(e){e?(this.isError=!1,this.loading=!0):this.isError=!0}},width(e){this.show=!1,this.$uv.sleep(2).then((e=>{this.show=!0})),this.imgWidth=e},height(e){this.show=!1,this.$uv.sleep(2).then((e=>{this.show=!0})),this.imgHeight=e}},computed:{wrapStyle(){let e={};return"heightFix"!==this.mode&&(e.width=this.$uv.addUnit(this.imgWidth)),"widthFix"!==this.mode&&(e.height=this.$uv.addUnit(this.imgHeight)),e.borderRadius="circle"==this.shape?"10000px":this.$uv.addUnit(this.radius),e.overflow=this.radius>0?"hidden":"visible",this.$uv.deepMerge(e,this.$uv.addStyle(this.customStyle))},imageStyle(){let e={};return e.borderRadius="circle"==this.shape?"10000px":this.$uv.addUnit(this.radius),e}},created(){this.elIndex=this.$uv.guid(),this.observer={},this.observerName="lazyLoadContentObserver"},mounted(){this.show=!0,this.$nextTick((()=>{this.observeLazyLoad&&this.observerFn()}))},methods:{onClick(){this.$emit("click")},onErrorHandler(e){this.loading=!1,this.isError=!0,this.$emit("error",e)},onLoadHandler(e){"widthFix"==this.mode&&(this.imgHeight="auto"),"heightFix"==this.mode&&(this.imgWidth="auto"),this.loading=!1,this.isError=!1,this.$emit("load",e),this.removeBgColor()},removeBgColor(){this.backgroundStyle={backgroundColor:"transparent"}},observerFn(){this.$nextTick((()=>{y("onLazyLoadReachBottom",(()=>{this.observeShow||(this.observeShow=!0)}))})),setTimeout((()=>{this.disconnectObserver(this.observerName);const e=f(this);e.relativeToViewport({bottom:this.thresholdValue}).observe(`.uv-image--${this.elIndex}`,(e=>{e.intersectionRatio>0&&(this.observeShow=!0,this.disconnectObserver(this.observerName))})),this[this.observerName]=e}),50)},disconnectObserver(e){const t=this[e];t&&t.disconnect()}}},[["render",function(e,t,a,s,u,d){const m=x,g=z(v("uv-icon"),O),y=p,f=z(v("uv-transition"),P);return u.show?(o(),l(f,{key:0,show:u.show,mode:"fade",duration:e.fade?e.duration:0,"cell-child":e.cellChild,"custom-style":d.wrapStyle},{default:i((()=>[r(y,{class:c(["uv-image",[`uv-image--${u.elIndex}`]]),onClick:d.onClick,style:n([d.wrapStyle,u.backgroundStyle])},{default:i((()=>[!u.isError&&u.observeShow?(o(),l(m,{key:0,src:e.src,mode:e.mode,onError:d.onErrorHandler,onLoad:d.onLoadHandler,"show-menu-by-longpress":e.showMenuByLongpress,"lazy-load":e.lazyLoad,class:"uv-image__image",style:n([d.imageStyle]),webp:e.webp},null,8,["src","mode","onError","onLoad","show-menu-by-longpress","lazy-load","style","webp"])):h("",!0),e.showLoading&&u.loading?(o(),l(y,{key:1,class:"uv-image__loading",style:n({borderRadius:"circle"==e.shape?"50%":e.$uv.addUnit(e.radius),backgroundColor:e.bgColor,width:e.$uv.addUnit(e.width),height:e.$uv.addUnit(e.height)})},{default:i((()=>[b(e.$slots,"loading",{},(()=>[r(g,{name:e.loadingIcon,width:e.width,height:e.height},null,8,["name","width","height"])]),!0)])),_:3},8,["style"])):h("",!0),e.showError&&u.isError&&!u.loading?(o(),l(y,{key:2,class:"uv-image__error",style:n({borderRadius:"circle"==e.shape?"50%":e.$uv.addUnit(e.radius),width:e.$uv.addUnit(e.width),height:e.$uv.addUnit(e.height)})},{default:i((()=>[b(e.$slots,"error",{},(()=>[r(g,{name:e.errorIcon,width:e.width,height:e.height},null,8,["name","width","height"])]),!0)])),_:3},8,["style"])):h("",!0)])),_:3},8,["class","onClick","style"])])),_:3},8,["show","duration","cell-child","custom-style"])):h("",!0)}],["__scopeId","data-v-22515f73"]]),Q=K({__name:"chat",setup(e){const t=w(1e3),a=w("");w([]),w([]);const s=w(!1),c=w(!1),m=w(!1),y=w(!1),f=w(null),b=w(0),T=w(1e4),U=_((()=>""===a.value.trim())),O=w({user_features:[],used_features:[],messages:[{role:"assistant",content:"您好，请问您最近生活如何，有什么心理上的困扰吗？"}],is_end:0});S((()=>{B((()=>{k({success:e=>{t.value=e.windowHeight}})}))}));const K=()=>{let e=a.value;a.value="",O.value.messages.push({role:"user",content:e}),s.value=!0,j({url:"http://9fv93og14537.vicp.fun:37636/chat/",method:"POST",data:O.value,success:({data:e})=>{s.value=!1,O.value=e,1==e.is_end&&(e.possible_diseases.length>0?(E("memory",O.value),c.value=!0,m.value=!0):(c.value=!0,y.value=!0))}})},P=()=>{N({url:"/pages/robot/recommend_scale"})},Q=()=>{F({url:"/pages/index/index"})},X=()=>{estimate()},Z=()=>{H({url:"/pages/index/index"})},ee=()=>{H({url:"/pages/index/index"})},te=e=>{b.value=e.detail.height+200+60+40,B((()=>{T.value+=1}))},ae=e=>{b.value=0};return(e,w)=>{const _=p,S=x,B=z(v("uv-loading-icon"),R),k=g,j=I,E=z(v("uv-textarea"),Y),N=z(v("uv-image"),J),F=z(v("uv-button"),A),H=M,se=z(v("uv-modal"),D);return o(),l(_,{class:"page",style:n({height:t.value+"px"})},{default:i((()=>[r(_,{class:"chatBorder"},{default:i((()=>[r(_,{class:"status_bar",style:n({height:C(G)()+"px"})},null,8,["style"]),r(_,{class:"titleBar",style:n({height:C(q)()+"px"})},{default:i((()=>[r(S,{src:W,onClick:ee}),r(_,{class:"navTitle"},{default:i((()=>[u(" 小麦助手 ")])),_:1})])),_:1},8,["style"]),r(_,{class:"scrollViewBorder"},{default:i((()=>[r(j,{"scroll-y":!0,class:"chatBox","scroll-top":T.value},{default:i((()=>[(o(!0),$(V,null,L(O.value.messages,((e,t)=>(o(),$(V,null,["assistant"==e.role?(o(),l(_,{key:0,class:"chatMessageAssistant"},{default:i((()=>[r(_,{class:"chatMessageAssistantContent"},{default:i((()=>[u(d(e.content),1)])),_:2},1024),r(_,{class:"",style:{flexGrow:"1"}})])),_:2},1024)):(o(),l(_,{key:1,class:"chatMessageUser"},{default:i((()=>[r(_,{class:"",style:{flexGrow:"1"}}),r(_,{class:"chatMessageUserContent"},{default:i((()=>[u(d(e.content),1)])),_:2},1024)])),_:2},1024))],64)))),256)),s.value?(o(),l(_,{key:0,class:"chatMessageAssistant"},{default:i((()=>[r(_,{class:"chatMessageAssistantLoadingIcon"},{default:i((()=>[r(B,{mode:"spinner",size:"34rpx"})])),_:1}),r(_,{class:"",style:{flexGrow:"1"}})])),_:1})):h("",!0),c.value?(o(),$(V,{key:1},[m.value?(o(),l(_,{key:0,class:"chatMessageAssistantResult"},{default:i((()=>[r(k,{style:{}},{default:i((()=>[u("经过我们刚才的交流，小麦已经为您准备好了合适的量表。点击下方按钮前往作答，小麦将向您提供更精确的评估结果。")])),_:1})])),_:1})):h("",!0),y.value?(o(),l(_,{key:1,class:"chatMessageAssistant"},{default:i((()=>[r(k,{class:"chatMessageAssistantContent"},{default:i((()=>[u("通过上述交流，我无法向您提供合适的量表")])),_:1}),r(_,{class:"",style:{flexGrow:"1"}})])),_:1})):h("",!0)],64)):h("",!0)])),_:1},8,["scroll-top"])])),_:1}),r(_,{class:"submitBox"},{default:i((()=>[c.value?(o(),$(V,{key:1},[m.value?(o(),l(_,{key:0,class:"boderBox"},{default:i((()=>[r(F,{"custom-style":{borderRadius:"14px"},type:"primary",class:"goNextButton",onClick:P},{default:i((()=>[u("立即前往")])),_:1})])),_:1})):h("",!0),y.value?(o(),l(_,{key:1,class:"boderBox"},{default:i((()=>[r(F,{"custom-style":{borderRadius:"14px"},type:"primary",class:"goNextButton",onClick:Q},{default:i((()=>[u("回到首页")])),_:1})])),_:1})):h("",!0)],64)):(o(),l(_,{key:0,class:"borderBox"},{default:i((()=>[r(E,{modelValue:a.value,"onUpdate:modelValue":w[0]||(w[0]=e=>a.value=e),placeholder:"请输入内容",maxlength:-1,border:"none",height:"60rpx","adjust-position":!1,textStyle:{fontSize:"26rpx"},customStyle:{borderRadius:"10px",display:"flex",flex:"1"},onFocus:te,onBlur:ae},null,8,["modelValue"]),s.value?(o(),l(_,{key:0,style:{display:"flex",width:"60rpx",height:"60rpx","justify-content":"center","align-self":"center"}},{default:i((()=>[r(B,{mode:"circle","timing-function":"ease-in-out",size:"36rpx"})])),_:1})):(o(),l(_,{key:1,class:"submit"},{default:i((()=>[U.value?(o(),l(N,{key:0,src:"/static/image/mp-axure-image/submit.png",width:"60rpx",height:"60rpx"})):(o(),l(N,{key:1,src:"/static/image/mp-axure-image/submit-h.png",width:"60rpx",height:"60rpx",onClick:K}))])),_:1}))])),_:1})),r(_,{style:n({height:b.value+"rpx"})},null,8,["style"])])),_:1}),r(_,{class:"safe-area-inset-bottom"})])),_:1}),r(se,{ref_key:"continueModal",ref:f,title:"已为您准备好相关题目",showCancelButton:"",closeOnClickOverlay:!1,confirmText:"前往完成",cancelText:"退出",onConfirm:X,onCancel:Z},{default:i((()=>[r(_,{class:"modalSlot"},{default:i((()=>[r(H,{nodes:"通过上述交流，我已为您匹配到最贴近您自身情况的量表作为辅助评估"})])),_:1})])),_:1},512)])),_:1},8,["style"])}}},[["__scopeId","data-v-5d493d23"]]);export{Q as default};
